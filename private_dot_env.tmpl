# Variables d'environnement privées - Générées par Chezmoi
# Fichier chiffré avec les secrets Bitwarden
# ⚠️ Ce fichier contient des informations sensibles

{{- if lookPath "bw" }}
# ===== CONFIGURATION BITWARDEN =====
# Session Bitwarden (sera définie dynamiquement)
# export BW_SESSION="$(bw unlock --raw)"

# ===== SECRETS DE DÉVELOPPEMENT =====
{{- $secrets := bitwarden "item" "Development Secrets" }}
{{- if $secrets }}
# Clés API de développement
export OPENAI_API_KEY="{{ $secrets.fields.openai_api_key.value }}"
export GITHUB_TOKEN="{{ $secrets.fields.github_token.value }}"
export GITLAB_TOKEN="{{ $secrets.fields.gitlab_token.value }}"

# Base de données
export DATABASE_URL="{{ $secrets.fields.database_url.value }}"
export REDIS_URL="{{ $secrets.fields.redis_url.value }}"

# Services externes
export STRIPE_SECRET_KEY="{{ $secrets.fields.stripe_secret_key.value }}"
export MAILGUN_API_KEY="{{ $secrets.fields.mailgun_api_key.value }}"
export AWS_ACCESS_KEY_ID="{{ $secrets.fields.aws_access_key_id.value }}"
export AWS_SECRET_ACCESS_KEY="{{ $secrets.fields.aws_secret_access_key.value }}"
{{- end }}

# ===== CONFIGURATION SSH =====
{{- $ssh := bitwarden "item" "SSH Keys" }}
{{- if $ssh }}
# Clés SSH (chemins vers les fichiers)
export SSH_KEY_PERSONAL="{{ $ssh.fields.personal_key_path.value }}"
export SSH_KEY_WORK="{{ $ssh.fields.work_key_path.value }}"
{{- end }}

# ===== CONFIGURATION GPG =====
{{- if .gpg_key_id }}
export GPG_TTY=$(tty)
export GPG_KEY_ID="{{ .gpg_key_id }}"
{{- end }}

{{- else }}
# ===== CONFIGURATION MANUELLE =====
# Bitwarden CLI non disponible - Configuration manuelle requise

# Exemple de variables d'environnement à définir :
# export GITHUB_TOKEN="your_github_token_here"
# export OPENAI_API_KEY="your_openai_key_here"
# export DATABASE_URL="postgresql://user:pass@localhost/db"

# ===== INSTRUCTIONS =====
# 1. Installez Bitwarden CLI : brew install bitwarden-cli
# 2. Connectez-vous : bw login
# 3. Déverrouillez : export BW_SESSION="$(bw unlock --raw)"
# 4. Créez les items suivants dans votre vault :
#    - "Development Secrets" avec les champs API
#    - "SSH Keys" avec les chemins des clés
# 5. Ré-appliquez la configuration : chezmoi apply

{{- end }}

# ===== CONFIGURATION LOCALE =====
{{- if .work }}
# Configuration entreprise
export COMPANY_VPN_CONFIG="~/.openconnect/company.conf"
export KUBECONFIG="~/.kube/config"
{{- end }}

{{- if .personal }}
# Configuration personnelle
export PERSONAL_SERVER="user@myserver.com"
export BACKUP_DESTINATION="/path/to/backup"
{{- end }}

# ===== OUTILS DE DÉVELOPPEMENT =====
# Node.js
export NODE_ENV="development"
export NPM_CONFIG_PREFIX="$HOME/.npm-global"

# PHP
{{- if lookPath "php" }}
export COMPOSER_MEMORY_LIMIT=-1
export PHP_IDE_CONFIG="serverName=localhost"
{{- end }}

# Python
export PYTHONDONTWRITEBYTECODE=1
export PYTHONUNBUFFERED=1

# Go
export GOPATH="$HOME/go"
export GOBIN="$GOPATH/bin"

# Rust
export CARGO_HOME="$HOME/.cargo"

# ===== CONFIGURATION TERMINAL =====
# Historique
export HISTSIZE=50000
export SAVEHIST=50000
export HISTFILE="$HOME/.zsh_history"

# Éditeur par défaut
export EDITOR="nvim"
export VISUAL="nvim"

# Pager
export PAGER="less"
export LESS="-R"

# ===== SÉCURITÉ =====
# Désactiver la télémétrie
export DO_NOT_TRACK=1
export HOMEBREW_NO_ANALYTICS=1
export NEXT_TELEMETRY_DISABLED=1

# ===== COULEURS =====
# Support des couleurs dans les outils
export FORCE_COLOR=1
export CLICOLOR=1

# ===== CHEMINS PERSONNALISÉS =====
# Ajout des binaires locaux au PATH
export PATH="$HOME/.local/bin:$PATH"
{{- if eq .chezmoi.os "darwin" }}
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
{{- end }}

# ===== CONFIGURATION SPÉCIFIQUE HOSTNAME =====
{{- if eq .chezmoi.hostname "work-laptop" }}
# Configuration spécifique pour le laptop de travail
export WORK_MODE=1
{{- else if eq .chezmoi.hostname "personal-desktop" }}
# Configuration spécifique pour le desktop personnel
export PERSONAL_MODE=1
{{- end }}

# ===== NOTES =====
# Ce fichier est automatiquement sourcé par .zshrc
# Pour ajouter des variables locales, utilisez ~/.env.local
# Pour des secrets temporaires, utilisez : export VAR=value (session uniquement)